---
const { title, description } = Astro.props;
---

<div class="p-4 my-4 border-2 border-green-300 rounded">
  <h2 class="text-2xl font-semibold">{ title }</h2>
  <p class="mb-2 text-xl">
    { description }
  </p>

  <div>
    <form name="add-subscriber" id="myForm" method="post" class="flex flex-col md:flex-row">
      <input type="text" name="userName" placeholder="First Name" class="w-full p-1 mb-2 leading-tight text-gray-800 bg-gray-200 border border-gray-500 rounded appearance-none md:h-10 md:mr-2 focus:outline-none focus:bg-white md:w-64">
      <input type="email" name="userEmail" placeholder="Email" class="w-full p-1 mb-2 leading-tight text-gray-800 bg-gray-200 border border-gray-500 rounded appearance-none md:mr-2 md:h-10 focus:outline-none focus:bg-white md:w-64">
      <button type="submit" name="button" class="w-full text-lg font-semibold text-center text-white no-underline bg-green-500 border border-green-500 rounded cursor-pointer md:h-10 sm:w-32">Subscribe</button>
    </form>
  </div>
</div>

<script>
  document.getElementById('myForm').addEventListener('submit', async function (event) {
    event.preventDefault();

    // Disable the subscribe button and show spinning wheel
    const subscribeButton = document.querySelector('#myForm button[type="submit"]');
    subscribeButton.disabled = true;

    const formData = {
      email: this.elements['userEmail'].value,
      name: this.elements['userName'].value,
    };

    const response = await fetch('https://windmill.cr.lvtd.dev/api/w/main/jobs/run/p/u/rasul/improving_script', {
      method: 'POST',
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer joeKSWJRzHZnNMFXq39GJXYc1mshy2"
      },
      body: JSON.stringify(formData),
    });

    if (response.ok) {
      console.log(response);
      const formElement = document.getElementById('myForm');
      formElement.innerHTML = `
        <div class="w-full p-2 text-lg text-gray-700 bg-green-100 border border-green-700 rounded">
          Thank for subscribing! You should receive an email soon.
        </div>
      `;
    } else {
      console.error('Subscription failed');
      subscribeButton.disabled = false;
      subscribeButton.innerHTML = 'Subscribe';

      const formElement = document.getElementById('myForm');
      formElement.innerHTML += `
        <div class="w-full p-2 text-lg text-gray-700 bg-red-100 border border-red-700 rounded mt-2">
          Subscription failed. Please try again.
        </div>
      `;
    }
  });
</script>
